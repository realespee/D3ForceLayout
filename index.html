<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Force Graph</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>
    <h1>Force Graph</h1>
    <canvas id='network' width='800' height='600'></canvas>

    <script>
        var graph = {
            nodes : [
                {'name': 'Jake', 'age':23},
                {'name': 'Joseph', 'age':3},
                {'name': 'Jaquelin', 'age':18},
                {'name': 'Jody', 'age':35},
                {'name': 'Jimmy', 'age':22},
                {'name': 'Jack', 'age':21},
                {'name': 'Jeremy', 'age':28}
            ],

            links : [
                {'source': 'Jaquelin', 'target' : 'Jack'},
                {'source': 'Jeremy', 'target' : 'Jaquelin'},
                {'source': 'Jimmy', 'target' : 'Jack'},
                {'source': 'Jody', 'target' : 'Joseph'},
                {'source': 'Jaquelin', 'target' : 'Jake'},
                {'source': 'Jody', 'target' : 'Jake'},
                {'source': 'Jaquelin', 'target' : 'Jake'},
                {'source': 'Joseph', 'target' : 'Jack'}
            ]
        }

        var canvas = d3.select("#network")
        var r=3,
            width = canvas.attr('width'),
            height = canvas.attr('height'),
            ctx = canvas.node().getContext('2d'),
            simulation = d3.forceSimulation()
                .force('x', d3.forceX(width/2))
                .force('y', d3.forceY(height/2))
                .force('collide', d3.forceCollide(r+2))
                .force('charge', d3.forceManyBody()
                    .strength(-20))
                .force('link', d3.forceLink()
                    .id(function(d){return d.PubNum}))
                // .on('tick', update)  

        Promise.all([
            d3.csv("/citationNodes.csv"),
            d3.csv("/citationEdges.csv"),
        ]).then(function(data) {
            
            var nodes = data[0],
                links = data[1]

            // console.log(nodes, links)

            // var nodes_array = [],
            //     links_array = [],

            //     pubNum_list = [],
            //     citing_list = []
            
            
            // for(i=0;i<nodes.length;i++){
            //     pubNum_list.push(nodes[i].PubNum);
            // }

            // for(j=0;j<links.length;j++){
            //     citing_list.push(links[j].Citing)
            // }

            // console.log(citing_list.length)
            // console.log(pubNum_list.length)

            //Return only unique elements of the arrays
            // pubNum_list = pubNum_list.filter((v, i, a) => a.indexOf(v) === i);
            // citing_list = citing_list.filter((v, i, a) => a.indexOf(v) === i);
           
        //    console.log(citing_list)
            // console.log(pubNum_list.length)
            // console.log(citing_list.length)
            // function isEqual(objList){
            //     objList.forEach()
            // }
            

            simulation
                .nodes(nodes)
        //     .force('link', d3.forceLink(links))
                .on('tick', update)
                .force('link')
                    .links(links)

        // graph.nodes.forEach(function(d){
        //     d.x = Math.random() * width;
        //     d.y = Math.random() * height;
        // })

            function update(){
                ctx.clearRect(0, 0, width, height)
            
                ctx.beginPath()
                links.forEach(drawLink);
                ctx.stroke()
            
                ctx.beginPath()
                nodes.forEach(drawNode);
                ctx.fill()
            }

        }).catch(function(err) {
            console.log(err)
            // handle error here
        })     

        
        function drawNode(d){
            ctx.moveTo(d.x, d.y);
            ctx.arc(d.x, d.y, r, 0, 2*Math.PI)
        }

        function drawLink(l){
            ctx.moveTo(l.source.x, l.source.y)
            ctx.lineTo(l.target.x, l.target.y)
        }
   

    </script>
</body>
</html>